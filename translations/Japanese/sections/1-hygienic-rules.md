## 1. 衛生的なルール

<img src="https://raw.githubusercontent.com/monifu/scala-best-practices/master/assets/scala-logo-256.png"  align="right" width="128" height="128" />

この章は、言語や開発環境を超えた汎用な衛生的規則についてです。
プログラミング言語はコンピュータシステムとコミュニケーションを取るための一つの形式ですが、
それだけではなくあなたの同僚や将来のあなた自身とのコミュニケーション手段でもあります。
なのでこれらの規則を重んじることは、当然のことといえます。

### 1.1 1行の長さは適切に"する必要がある"

活版印刷技術の世界全般に、人は文字列が横に広がると集中力を失うと言われています。
長すぎる文章は文の始まりと終わりの判断や次の行に読み進めていくことを難しくます。
何度も右から左へ目を動かさなければならない。
このことは、重要な部分を読み解くことも困難にします。

活版印刷においては、適切な一行の長さは50文字から70文字程度だと考えられています。

プログラミングにおいては、インデントを用いるので、1行を60文字に制限するというのは実用的ではありません
普通は80文字なら受け入れられますが、Scalaではそうではありません。
なぜなら、Scalaではよくclosureが用いられ、関数やクラスに長く説明的な名前をつけようとすると80文字では短すぎます。

一方で、IntelliJ IDEAが標準で設定されているような、1行120文字というのは長すぎるでしょう。
16：9の大きな画面を使っていても、読みやすくなるわけではありません。
より短い文をこれらの広い画面に映し出すことで、間違えてしまった時に役に立ちます。
また、長い文章は終わりの方にある重要な部分に気がつくための努力を必要とします。

したがって、バランスとしては

* まずは80文字を簡単な（soft）制限として心がけましょう
* もし、それで足りなければ100文字なら十分です
* ただし、関数を定義するときは除きます。もし制限すると、とても不格好になるでしょう

一方で、120文字を超えるようなものは嫌悪の対象になります。

### 1.2 フォーマットをするためにSBTやIDEのプラグインに頼っては"いけない"

IDEやSBTのプラグインはとても役立つものですが、もし自動であなたの書いたコードをフォーマット
する機能を使おうと思っているなら、気をつけてください。

あなたが開発者の意図を推測できるプラグインを見つけられないでしょう、なぜならそのためには人間に近いコードに対する理解が要求され、
それを作ることは不可能に近いからです。規約にそってインデントしたりフォーマットする目的は,
おまじないとして設定された厳格なルールに従うためではなく、コードをより論理的で読みやすく、わかりやすくするためです。
実際はインデントは美術的な書式で、それは恐ろしいものではありません、なぜならあなたにはひどいコードにたいする鼻とそれを修正する衝動さえあれば良いからです。
それに、他の人のコードがひどいものでないか確かめることは、
開発者の仕事と言えるからです。

したがって、自動化された手段はよいことですが、他の人が注意を払ってフォーマットしたコードを台無しにしてしまわないように"注意してください"、
さもないと、その文のせいで叩かれるかもしれません。

私が述べたことについて考えてみましょう。もし一行が長かった場合、プラグインはどのようにしてそれを改行しようとするでしょうか？
この行について見てみましょう。（これは実際のコードです）:

```scala
val dp = new DispatchPlan(new Set(filteredAssets), start = startDate, end = endDate, product, scheduleMap, availabilityMap, Set(activationIntervals.get), contractRepository, priceRepository)
```

ほとんどの場合、プラグインはただ短くするだけです。実際わたしはこれまでこのようなコードをたくさん見たことがあります。

```scala
val dp = new DispatchPlan(Set(filteredAssets), start =
  startDate, end = endDate, product, scheduleMap, availabilityMap,
  Set(activationIntervals), contractRepository, priceRepository)
```

これは読みやすくはないですよね。つまり、率直に言って、吐き気がしてくるようです。
それはまさしく、私が目にしたフォーマット作業をプラグインに頼っている人が持ってきた成果と同じ種類のものです。
また、このようにすることもできます:

```scala
val dp = new DispatchPlan(
  Set(filteredAssets),
  startDate,
  endDate,
  product,
  scheduleMap,
  availabilityMap,
  Set(activationIntervals),
  contractRepository,
  priceRepository
)
```

こちらのほうがよっぽど良さそうです。
しかし、実際には、別のケースになるとあまり良くありません。
次のような改行したいと思う行があったとしましょう:

```scala
val result = service.something(param1, param2, param3, param4).map(transform)
```

今回は関数のパラメータが関数と同じ行にあり、よくありません。
あなたがどう対処しても変わりありません。

```scala
// transformの呼び出しが見難いので良くない
  val result = service.something(
 param1,
 param2,
 param3,
 param4).map(transform)

// 論理的な流れを分断しているので良くない
val result = service.something(
  param1,
  param2,
  param3,
  param4
  ).map(transform)
```

こちらのほうが良さそうです。

```scala
val result = service
  .something(param1, param2, param3, param4)
  .map(transform)
```

このほうがよいのではないでしょうか。もちろん、時には関数の呼び出しを省略しないことで
とても長くなることはあります。
なので、一時変数に頼る必要もあるでしょう。例えば...

```scala
val result = {
  val instance =
    object.something(
      myAwesomeParam1,
      otherParam2,
      someSeriousParam3,
      anEvenMoreSoParam4,
      lonelyParam5,
      catchSomeFn6,
      startDate7
    )

  for (x <- instance) yield
    transform(x)
}
```

当然ですが、コードからひどい悪臭のする場合には、リファクタリングをするよう必要があるでしょう -
おそらく、一つの関数のために幾つもの変数が存在している場合です。

行の長さについて厳密に述べてきました - 一度別の問題に陥ると、事態はより複雑なものになります。
そして本当に、これを解析しあなたのために正しい決断を下すことのできるプラグインは見つからないでしょう。

### 1.3 長い関数は分割"する必要がある"

理想としては、関数はたった2、3行の長さであるべきです。
行があまり大きくなってきたら、それらを細かい関数に分割し、それらに名前をつけます。

Scalaでは、それらの中間生成物を他のスコープでも使えるようにしなければいけない必要はなく、ここでの目的は
読みやすさを手助けするのが主な目的で、Scalaではロジックを細かくするために内部関数ができることに気をつけてください。

### 1.4 名前やコメントにスペルの間違いを持ち込んでは"いけない"

間違ったスペルは不意に人をいらだたせ、読んでいる人の流れを遮ります。
スペルチェック機能を使いましょう。
賢いIDEは組み込みのスペルチェック機能を持っています。下線の引かれたスペルの警告に注意し、修正しましょう。

### 1.5 名前は意味が無いと"いけない"

"_コンピューターサイエンスの世界には難しいことは2つしかない: キャッシュを無効化することと物事に名前をつけることだ。_" -- Phil Karlton

ここに3つのガイドラインがあります。

1. 説明的な名前をつけましょう、しかしやり過ぎはいけません、4単語はすでにちょっと長すぎます
2. 近くの文脈から型や目的が簡単に類推できる場合、またはすでに慣習化された習慣がある場合は、簡潔に名前付けできます
3. もし説明的な名前をつけるルートを行くときは、意味のない最低な単語はやめましょう。

例えば、この例は許容されます:

```scala
for (p <- people) yield
  transformed(p)
```

`p`がpersonであることは近くの文脈からわかるので、短い1文字の名前でも問題ありません。
こちらも、`i`がインデックスと使われることが慣習になっているので容認されます。

```scala
for (i <- 0 until limit) yield ???
```

今度は一般的には受け入れられません、なぜならタプルを使ったコレクションの名前付けは、
何を持っているかということを十分に反映していないからです。（それらの要素に名前を与えなかったとしたら、
結果としてコレクション自身が悪い名前を持つことになるでしょう。）

``` scala
someCollection.map(_._2)
```

一方で、黙示的なパラメータは短い名前でも大丈夫です。それは、疑うこともなく渡され、
それらが行方不明にならないかぎり気にすることはないからです。

```scala
def query(id: Long)(implicit ec: ExecutionContext, c: WSClient): Future[Response]
```

次の例は、たとえ説明的な名前にしようと明らかに試みていたとしても、名前が全く意味をなしていないので受け入れられません。

```scala
def processItems(people: Seq[Person]) = ???
```

これが受け入れられないのは、関数に命名することが副作用（`process`が命令を示した動詞です。）
を示していて、`people`に対して何をするかが表現されていないからです。
`Items`という接尾語にも意味はありません。なぜなら、`processThingy`、`processRows`、`processStuff`と呼ぶかもしれませんし、それらもまた全く同じことがいえます - 全く意味がありません。
また、これは見た目にも乱雑さが増し、単語が多くなれば多くなるほど、読まなければならない文字が増え、
意味のない言葉は単なる雑音でしかありません。

適切に選ばれた説明的な名前は - よいです。 最低な名前は - 最悪です。
